<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="description" content="Nate Tracy-Amoroso's Personal Website">
    <meta name="author" content="Nate Tracy-Amoroso">
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-111016820-3"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-111016820-3');
    </script>
    <link rel="stylesheet" href="/assets/css/styles.css"/>

    <link rel="stylesheet" href="/assets/css/atom-one-dark.css">
    <script src="/assets/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
</head>
<body>
<div id="header-and-page">
    <a id='homepage-link' href="/"><h1>Nate Tracy-Amoroso</h1></a>
    <div>
        <a href="/">Home</a> > Multiple belongs_to relationships to the same model rails

<article class="post">
<p>First create a table two references. We’ll create a bike table with a owner and a seller reference.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># db/migrate/123_create_bikes.rb</span>
<span class="k">class</span> <span class="nc">CreateBikes</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">6.0</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:bikes</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">references</span> <span class="ss">:owner</span><span class="p">,</span> <span class="ss">index: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">foreign_key: </span><span class="p">{</span><span class="ss">to_table: :people</span><span class="p">}</span> <span class="c1"># column is owner_id</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">references</span> <span class="ss">:seller</span><span class="p">,</span> <span class="ss">index: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">foreign_key: </span><span class="p">{</span><span class="ss">to_table: :people</span><span class="p">}</span> <span class="c1"># column is seller_id</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">timestamps</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Now we create our two models. Bikes belong to two different people owners and sellers.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Bike.rb</span>
<span class="k">class</span> <span class="nc">Bike</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">belongs_to</span> <span class="ss">:owner</span><span class="p">,</span> <span class="ss">:class_name</span> <span class="o">=&gt;</span> <span class="s1">'Person'</span><span class="p">,</span> <span class="ss">:foreign_key</span> <span class="o">=&gt;</span> <span class="s1">'owner_id'</span>
  <span class="n">belongs_to</span> <span class="ss">:seller</span><span class="p">,</span> <span class="ss">:class_name</span> <span class="o">=&gt;</span> <span class="s1">'Person'</span><span class="p">,</span> <span class="ss">:foreign_key</span> <span class="o">=&gt;</span> <span class="s1">'seller_id'</span>
<span class="k">end</span>
</code></pre></div></div>

<p>And people have two kinds of bikes, those they’ve sold and those they own.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Person.rb</span>
<span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_many</span> <span class="ss">:owned_bikes</span><span class="p">,</span> <span class="ss">class_name: </span><span class="s1">'Bike'</span><span class="p">,</span> <span class="ss">foreign_key: </span><span class="s1">'owner_id'</span> 
  <span class="n">has_many</span> <span class="ss">:sold_bikes</span><span class="p">,</span> <span class="ss">class_name: </span><span class="s1">'Bike'</span><span class="p">,</span> <span class="ss">foreign_key: </span><span class="s1">'seller_id'</span> 
<span class="k">end</span>
</code></pre></div></div>

<p>Now let’s see how it works.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>p1 = Person.create(name: "P1!")
p2 = Person.create(name: "P2!")
bike = Bike.create(owner: p1, seller: p2)
bike.owner.name
&gt; "P1!"
bike.seller.name
&gt; "P2!"
p1.owned_bikes.pluck(:id)
&gt; [1]
p1.sold_bikes.pluck(:id)
&gt; []
p2.owned_bikes.pluck(:id)
&gt; [0]
p2.sold_bikes.pluck(:id)
&gt; [1]
</code></pre></div></div>

<p>And it all looks good!</p>

</article>

    </div>
</div>

</body>
</html>
