<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="description" content="Nate Tracy-Amoroso's Personal Website">
    <meta name="author" content="Nate Tracy-Amoroso">
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-111016820-3"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-111016820-3');
    </script>
    <link rel="stylesheet" href="/assets/css/styles.css"/>

    <link rel="stylesheet" href="/assets/css/atom-one-dark.css">
    <script src="/assets/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
</head>
<body>
<div id="header-and-page">
    <a id='homepage-link' href="/"><h1>Nate Tracy-Amoroso</h1></a>
    <div>
        <a href="/">Home</a> > Factory Bot Rails: Creating dummy data for developing your application 

<article class="post">
<p>It’s often helpful to see how our UI’s scale with lots of data in them but seeding data manually in very slow. So using <a href="https://github.com/thoughtbot/factory_bot_rails">factory_bot_rails</a> and <a href="https://github.com/stympy/faker">Faker</a> I’ll show you how to make a whole lot of realistic data quickly.</p>

<p>First step install the gems. Add these gems to your Gemfile:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">group</span> <span class="ss">:development</span><span class="p">,</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">'factory_bot_rails'</span>
  <span class="n">gem</span> <span class="s1">'faker'</span>
<span class="k">end</span></code></pre></figure>

<p>Next we’ll need to setup our factories. A factory is an easily called snippet that creates a model for you. In general they are found in the test/ spec/ and factories/ directories. I generally put mine in spec/factories/model_name.rb. So for an an example model of a user, we might provide a firstname, lastname, Department (a belongs to relationship), and username.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># spec/factories/user.rb</span>
<span class="no">FactoryBot</span><span class="p">.</span><span class="nf">define</span> <span class="k">do</span>
  <span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
    <span class="n">firstname</span> <span class="p">{</span> <span class="s1">'John'</span> <span class="p">}</span>
    <span class="n">lastname</span>  <span class="p">{</span> <span class="s1">'Doe'</span> <span class="p">}</span>
    <span class="n">department</span>  <span class="p">{</span> <span class="no">Department</span><span class="p">.</span><span class="nf">all</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">}</span> <span class="c1"># we're assuming a department exists here</span>
    <span class="n">username</span> <span class="p">{</span> <span class="s1">'cmw233'</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>But this isn’t great as it will create the same user every time. What if we want each user to be unique?</p>

<p>Enter Faker. Faker allows you to generate either deterministic (keeps your test cases consistent) to random-ish data of many many many types. Faker can generate names, addresses, phone numbers, countries, almost whatever you need. Here’s how you call it.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">fname</span> <span class="o">=</span> <span class="no">Faker</span><span class="o">::</span><span class="no">Name</span><span class="o">::</span><span class="n">first_name</span></code></pre></figure>

<p>And to see a full list of Faker’s <a href="https://github.com/stympy/faker#generators">see this list.</a></p>

<p>Now combining the two ideas we can do something like this:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># spec/factories/user.rb</span>
<span class="no">FactoryBot</span><span class="p">.</span><span class="nf">define</span> <span class="k">do</span>
  <span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
    <span class="n">firstname</span> <span class="p">{</span> <span class="no">Faker</span><span class="o">::</span><span class="no">Name</span><span class="o">::</span><span class="n">first_name</span> <span class="p">}</span>
    <span class="n">lastname</span>  <span class="p">{</span> <span class="no">Faker</span><span class="o">::</span><span class="no">Name</span><span class="o">::</span><span class="n">last_name</span> <span class="p">}</span>
    <span class="n">department</span>  <span class="p">{</span> <span class="no">Department</span><span class="p">.</span><span class="nf">all</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">}</span>
    <span class="n">username</span> <span class="p">{</span> <span class="no">Faker</span><span class="o">::</span><span class="no">Internet</span><span class="p">.</span><span class="nf">username</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>And with a little bit of ruby-foo outside of Factory Bot or Faker you can randomize the relationship by selecting a random # between 0 and the number of departments - 1.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">    <span class="n">department</span>  <span class="p">{</span> <span class="no">Department</span><span class="p">.</span><span class="nf">all</span><span class="p">[</span><span class="nb">rand</span><span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="no">Department</span><span class="p">.</span><span class="nf">all</span><span class="p">.</span><span class="nf">length</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="p">}</span></code></pre></figure>

<p>Okay now that we have factories all set up lets call them from our seeds. We can either build or create a factory. Building a factory creates the model and fills the attributes, creating it does the same but it also saves. Here’s what your seeds.rb could look like:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># db/seeds.rb</span>
<span class="k">for</span> <span class="n">x</span> <span class="k">in</span> <span class="mi">1</span><span class="o">..</span><span class="mi">1000</span> <span class="k">do</span>
  <span class="no">FactoryBot</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span>
  <span class="c1"># create 1000 users and save them</span>
<span class="k">end</span>
<span class="n">special_user</span> <span class="o">=</span> <span class="no">FactoryBot</span><span class="p">.</span><span class="nf">build</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span>
<span class="n">special_user</span><span class="p">.</span><span class="nf">firstname</span> <span class="o">=</span> <span class="s2">"Nate"</span>
<span class="n">special_user</span><span class="p">.</span><span class="nf">lastname</span> <span class="o">=</span> <span class="s2">"who wrote this"</span>
<span class="n">special_user</span><span class="p">.</span><span class="nf">save!</span> <span class="c1"># without this the model wouldn't be saved to the db.</span></code></pre></figure>


</article>

    </div>
</div>

</body>
</html>
